
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Retail Sales Forecasting &#8212; Lawrence Lin</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="League of Legends Win Classifier" href="lolwin.html" />
    <link rel="prev" title="From school" href="../viz.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Lawrence Lin</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Data Visualizations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../viz.html">
   From school
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Undergrad Projects
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Retail Sales Forecasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lolwin.html">
   League of Legends Win Classifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sansum.html">
   Sansum
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Graduate Projects
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../grad/featimp.html">
   Feature Importance
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/undergrad/LL-174-Final.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/lawrencedlin/lawrencedlin.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/lawrencedlin/lawrencedlin.github.io/issues/new?title=Issue%20on%20page%20%2Fundergrad/LL-174-Final.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Retail Sales Forecasting
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#i-abstract">
   I. Abstract
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ii-introduction">
   II. Introduction
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iii-model-building-and-forecasting">
   III. Model Building and Forecasting
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-identification">
     Model Identification
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-estimation">
     Model Estimation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#diagnostic-checking">
     Diagnostic Checking
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#forecasting">
     Forecasting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iv-conclusion">
   IV. Conclusion
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#v-references">
   V. References
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vi-appendix">
   VI. Appendix
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="retail-sales-forecasting">
<h1>Retail Sales Forecasting<a class="headerlink" href="#retail-sales-forecasting" title="Permalink to this headline">¶</a></h1>
</section>
<hr class="docutils" />
<section id="i-abstract">
<h1>I. Abstract<a class="headerlink" href="#i-abstract" title="Permalink to this headline">¶</a></h1>
<p>In this report I will attempt extract information on economic activity
in the restaurant industry throughout the year. I will do this by
applying time series techniques on retail sales (in millions of dollars)
of food services and drinking places. Using a Box-Jenkins methodology, I
build a model and forecast with it. I find that economic activity in the
restaurant industry is highest in summer months and lowest in the two
months after Christmas. I conclude from my forecasts that the demand for
food services and drinking places is steadily growing.</p>
</section>
<section id="ii-introduction">
<h1>II. Introduction<a class="headerlink" href="#ii-introduction" title="Permalink to this headline">¶</a></h1>
<p>Retail sales are one of the primary measures of consumer demand for both
durable and non-durable goods. Retail sales is an important economic
indicator that widely used in government, academic, and business
communities to measure economic health. This dataset provides the retail
sales of food services and drinking places in millions of dollars each
month.</p>
<p>In this report, I will model and forecast retail sales to gain insight
into the state of the food-service industry. I will use differencing and
Box-Cox transformations to make the data stationary. Then, I will
identify candidate models from the ACF/PACF of the transformed and
differenced time series. I will estimate the parameters of the candidate
models and select the model using AICc and performing diagnostic
checking to ensure the model is a good fit. Lastly, I will forecast on
the transfromed and original data using the final model.</p>
<p>I was able to find that retail sales is growing steadily over time.
However, my forecasts were not able to account for the near 30% drop in
retail sales from Covid-19 in the past few months.</p>
<p>My data was downloaded from
<a class="reference external" href="https://fred.stlouisfed.org/series/RSFSDPN">https://fred.stlouisfed.org/series/RSFSDPN</a>. My report was made through
the ggplot2, ggfortify, forecast, MASS, and qpcR packages.</p>
</section>
<section id="iii-model-building-and-forecasting">
<h1>III. Model Building and Forecasting<a class="headerlink" href="#iii-model-building-and-forecasting" title="Permalink to this headline">¶</a></h1>
<section id="model-identification">
<h2>Model Identification<a class="headerlink" href="#model-identification" title="Permalink to this headline">¶</a></h2>
<p>We can see from plotting the original data that the data is
non-stationary: there is a linear trend and a seasonal component. The
ACF confirms this as it remains large and periodic even at large lags.
We suspect the period s = 12 because we see small spikes in the ACF at
multiples of 12. We can also see that the variance seems to be
increasing with time and the histogram of the data is skewed.</p>
<p><a class="reference internal" href="../_images/Original-data-1.png"><img alt="../_images/Original-data-1.png" src="../_images/Original-data-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Original-data-2.png"><img alt="../_images/Original-data-2.png" src="../_images/Original-data-2.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Original-data-3.png"><img alt="../_images/Original-data-3.png" src="../_images/Original-data-3.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Original-data-4.png"><img alt="../_images/Original-data-4.png" src="../_images/Original-data-4.png" style="width: 50%;" /></a></p>
<p>I try a Box-Cox transformation to stabilize the variance/seasonal effect
and to make the data more normally distributed. Because <em>λ</em> = 0 is
within the 95% Confidence interval of the Box-Cox transformation, we use
a log-transformation on the original data. We can see that the variance
is no longer increasing with time and the data is more normally
distributed.</p>
<a class="reference internal image-reference" href="../_images/BoxCox-1.png"><img alt="../_images/BoxCox-1.png" src="../_images/BoxCox-1.png" style="width: 70%;" /></a>
<p>We plot the time series, a histogram, and the P/ACF of the
log-transformed data here.</p>
<p><a class="reference internal" href="../_images/Log-data-1.png"><img alt="../_images/Log-data-1.png" src="../_images/Log-data-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Log-data-2.png"><img alt="../_images/Log-data-2.png" src="../_images/Log-data-2.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Log-data-3.png"><img alt="../_images/Log-data-3.png" src="../_images/Log-data-3.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Log-data-4.png"><img alt="../_images/Log-data-4.png" src="../_images/Log-data-4.png" style="width: 50%;" /></a></p>
<p>To eliminate seasonality, we try differencing the log-transformed data
at lag 12. The variance decreases, so the data is not overdifferenced.
From the plot we can see that there is now no trend. When we difference
again at lag 1 to remove a potential linear trend, the variance
increases, so the differencing is unnecessary and our data is
stationary.</p>
<p>We look at the P/ACF of Sales.train.log differenced at lag 12 to
identify the model. ACF appears to be oscillating. From Lecture 13 we
can suspect an AR model.<br />
PACF is outside confidence intervals at lags 1,2, maybe 3, maybe 10,
maybe 12, maybe 16. PACF appears to cut off at lag 2 or lag 3, with a
small spike at lag 12. We suspect p = 2 or p = 3, with P = 0 or P = 1.</p>
<p>SARIMA(3, 0, 0) × (0, 1, 0)<sub>12</sub>
SARIMA(2, 0, 0) × (0, 1, 0)<sub>12</sub>
SARIMA(3, 0, 0) × (1, 1, 0)<sub>12</sub>
SARIMA(2, 0, 0) × (1, 1, 0)<sub>12</sub></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>## [1] &quot;Variance of Sales.train.log&quot;

## [1] 0.02388367

## [1] &quot;Variance of Sales.train.log differenced at lag 12&quot;

## [1] 0.0004169038
</pre></div>
</div>
<p><a class="reference internal" href="../_images/Seasonality-1.png"><img alt="../_images/Seasonality-1.png" src="../_images/Seasonality-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Seasonality-2.png"><img alt="../_images/Seasonality-2.png" src="../_images/Seasonality-2.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Seasonality-3.png"><img alt="../_images/Seasonality-3.png" src="../_images/Seasonality-3.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Seasonality-4.png"><img alt="../_images/Seasonality-4.png" src="../_images/Seasonality-4.png" style="width: 50%;" /></a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>## [1] &quot;Variance of Sales.train.log differenced at lag 1 and lag 12&quot;

## [1] 0.0005385189
</pre></div>
</div>
</section>
<section id="model-estimation">
<h2>Model Estimation<a class="headerlink" href="#model-estimation" title="Permalink to this headline">¶</a></h2>
<p>We estimate the parameters of the models using MLE. We see that that the
SAR component in model B and model C is not significant because it is
within the 95% confidence interval; standard deviation is bigger than
estimate of the coefficient. This leaves us with model A and model D.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>## [1] &quot;Model A&quot;

## 
## Call:
## arima(x = Sales.train.log, order = c(3, 0, 0), seasonal = list(order = c(0, 
##     1, 0), period = 12), method = &quot;ML&quot;)
## 
## Coefficients:
##          ar1     ar2     ar3
##       0.2572  0.4012  0.3129
## s.e.  0.0962  0.0909  0.0970
## 
## sigma^2 estimated as 0.0003266:  log likelihood = 250.29,  aic = -492.59

## [1] &quot;Model B&quot;

## 
## Call:
## arima(x = Sales.train.log, order = c(2, 0, 0), seasonal = list(order = c(1, 
##     1, 0), period = 0), method = &quot;ML&quot;)
## 
## Coefficients:
##          ar1     ar2     sar1
##       0.4289  0.5349  -0.0586
## s.e.  0.0847  0.0850   0.1090
## 
## sigma^2 estimated as 0.0003611:  log likelihood = 245.53,  aic = -483.06

## [1] &quot;Model C&quot;

## 
## Call:
## arima(x = Sales.train.log, order = c(3, 0, 0), seasonal = list(order = c(1, 
##     1, 0), period = 12), method = &quot;ML&quot;)
## 
## Coefficients:
##          ar1     ar2     ar3     sar1
##       0.2540  0.3983  0.3243  -0.1032
## s.e.  0.0961  0.0906  0.0974   0.1094
## 
## sigma^2 estimated as 0.0003231:  log likelihood = 250.73,  aic = -491.47

## [1] &quot;Model D&quot;

## 
## Call:
## arima(x = Sales.train.log, order = c(2, 0, 0), seasonal = list(order = c(0, 
##     1, 0), period = 12), method = &quot;ML&quot;)
## 
## Coefficients:
##          ar1     ar2
##       0.4263  0.5336
## s.e.  0.0846  0.0850
## 
## sigma^2 estimated as 0.0003623:  log likelihood = 245.39,  aic = -484.78
</pre></div>
</div>
<p>Before we move onto diagnostic checking, we want to make sure that our
models are causal and stationary. Because model A and model D are both
pure AR(p) models, they are always invertible. We show that both models
are both causal and stationary because all of their roots lie inside of
the unit circle.</p>
<p><a class="reference internal" href="../_images/invroots-1.png"><img alt="../_images/invroots-1.png" src="../_images/invroots-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/invroots-2.png"><img alt="../_images/invroots-2.png" src="../_images/invroots-2.png" style="width: 50%;" /></a></p>
</section>
<section id="diagnostic-checking">
<h2>Diagnostic Checking<a class="headerlink" href="#diagnostic-checking" title="Permalink to this headline">¶</a></h2>
<p>Now we will perform diagnostic checking on model A to determine whether
our model is a good fit by analyzing the residuals. If our model is a
good fit, the residuals should exhibit behavior similar to a White Noise
process. Our plot of the residuals shows that the mean is about zero
,there is little to no trend, no seasonality, and no change in variance.
The residuals are roughly normally distributed, and the quantile -
quantile plot forms a straight line. The residuals also pass the
Shapiro-Wilk normality test. The sample P/ACF of the residuals can be
counted as 0 after applying Bartlett’s formula, as well as the ACF of
the residuals squared. The residuals pass the Box-Pierce test and
Ljung-Box test, so we accept our WN hypothesis at level 0.05. The
squared residuals pass the Mcleod-li test so there is not nonlinear
dependence. After applying Yule-Walker estimation and AICC statistics to
the residuals, they come out as an AR(0) process so they are compatible
with WN.</p>
<p><a class="reference internal" href="../_images/Diagnostic-Model-a-1.png"><img alt="../_images/Diagnostic-Model-a-1.png" src="../_images/Diagnostic-Model-a-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-a-2.png"><img alt="../_images/Diagnostic-Model-a-2.png" src="../_images/Diagnostic-Model-a-2.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-a-3.png"><img alt="../_images/Diagnostic-Model-a-3.png" src="../_images/Diagnostic-Model-a-3.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-a-4.png"><img alt="../_images/Diagnostic-Model-a-4.png" src="../_images/Diagnostic-Model-a-4.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-a-5.png"><img alt="../_images/Diagnostic-Model-a-5.png" src="../_images/Diagnostic-Model-a-5.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-a-6.png"><img alt="../_images/Diagnostic-Model-a-6.png" src="../_images/Diagnostic-Model-a-6.png" style="width: 50%;" /></a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>## 
##  Shapiro-Wilk normality test
## 
## data:  res.a
## W = 0.98174, p-value = 0.1409

## 
##  Box-Pierce test
## 
## data:  res.a
## X-squared = 10.395, df = 8, p-value = 0.2384

## 
##  Box-Ljung test
## 
## data:  res.a
## X-squared = 11.583, df = 8, p-value = 0.1708

## 
##  Box-Ljung test
## 
## data:  res.a.sq
## X-squared = 5.8357, df = 11, p-value = 0.8841

## 
## Call:
## ar(x = res.a, aic = TRUE, order.max = NULL, method = c(&quot;yule-walker&quot;))
## 
## 
## Order selected 0  sigma^2 estimated as  0.0002988

## [1] &quot;AICC of Model A&quot;

## [1] -492.3585
</pre></div>
</div>
<p>Now we perform diagnostic tests on model D. Our plot of the residuals
shows that the mean is about zero ,there is little to no trend, no
seasonality, and no change in variance. The residuals less normally
distributed than model A, but the quantile - quantile plot still forms a
straight line. The residuals pass the Shapiro-Wilk normality test. We
see a few significant spikes in the P/ACF of the residuals, as well as
the ACF of the residuals squared. The residuals fail the Box-Pierce test
and Ljung-Box test, so we reject our WN hypothesis at level 0.05. The
squared residuals pass the Mcleod-li test. After applying Yule-Walker
estimation and AICC statistics to the residuals, they come out as an
AR(2) process, showing that there is some information that is not being
captured by our model. Based off the diagnostic checking, we reject
model D as a good fit for the data.</p>
<p><a class="reference internal" href="../_images/Diagnostic-Model-d-1.png"><img alt="../_images/Diagnostic-Model-d-1.png" src="../_images/Diagnostic-Model-d-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-d-2.png"><img alt="../_images/Diagnostic-Model-d-2.png" src="../_images/Diagnostic-Model-d-2.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-d-3.png"><img alt="../_images/Diagnostic-Model-d-3.png" src="../_images/Diagnostic-Model-d-3.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-d-4.png"><img alt="../_images/Diagnostic-Model-d-4.png" src="../_images/Diagnostic-Model-d-4.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-d-5.png"><img alt="../_images/Diagnostic-Model-d-5.png" src="../_images/Diagnostic-Model-d-5.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Diagnostic-Model-d-6.png"><img alt="../_images/Diagnostic-Model-d-6.png" src="../_images/Diagnostic-Model-d-6.png" style="width: 50%;" /></a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>## 
##  Shapiro-Wilk normality test
## 
## data:  res.d
## W = 0.98171, p-value = 0.1401

## 
##  Box-Pierce test
## 
## data:  res.d
## X-squared = 22.262, df = 9, p-value = 0.008085

## 
##  Box-Ljung test
## 
## data:  res.d
## X-squared = 24.164, df = 9, p-value = 0.00405

## 
##  Box-Ljung test
## 
## data:  res.d.sq
## X-squared = 9.2166, df = 11, p-value = 0.6019

## 
## Call:
## ar(x = res.d, aic = TRUE, order.max = NULL, method = c(&quot;yule-walker&quot;))
## 
## Coefficients:
##       1        2  
## -0.1758  -0.1864  
## 
## Order selected 2  sigma^2 estimated as  0.000315

## [1] &quot;AICC of Model D&quot;

## [1] -484.6649
</pre></div>
</div>
<p>We choose model A because of the more desirable properties of its
residuals and its lower AICc. Our final model is
(1 − <em>B</em><sup>12</sup>)(1 − 0.257<em>B</em> − 0.401<em>B</em><sup>2</sup> − 0.313<em>B</em><sup>3</sup>)<em>X</em><sub><em>t</em></sub> = <em>Z</em><sub><em>t</em></sub></p>
<p>where <em>Z</em><sub><em>t</em></sub> ∼ <em>N</em>(0, 0.00032).</p>
<p>We now move on to forecasting. We assume an adequate time series model
was obtained and MLE estimates of coefficents are obtained from the
previous steps. We can forecast on the log-transformed data first. We
can see that test set falls with our 95% Prediction intervals.</p>
</section>
<section id="forecasting">
<h2>Forecasting<a class="headerlink" href="#forecasting" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../_images/Forecasting-log-1.png"><img alt="../_images/Forecasting-log-1.png" src="../_images/Forecasting-log-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Forecasting-log-2.png"><img alt="../_images/Forecasting-log-2.png" src="../_images/Forecasting-log-2.png" style="width: 50%;" /></a></p>
<p>Now we forecast on the original data by exponentiating the forecasted
values prior. The test set still falls within our 95% Prediction
intervals.</p>
<p><a class="reference internal" href="../_images/Forecasting-original-1.png"><img alt="../_images/Forecasting-original-1.png" src="../_images/Forecasting-original-1.png" style="width: 50%;" /></a><a class="reference internal" href="../_images/Forecasting-original-2.png"><img alt="../_images/Forecasting-original-2.png" src="../_images/Forecasting-original-2.png" style="width: 50%;" /></a></p>
</section>
</section>
<section id="iv-conclusion">
<h1>IV. Conclusion<a class="headerlink" href="#iv-conclusion" title="Permalink to this headline">¶</a></h1>
<p>In conclusion, I was able to successfully model the data as a AR(3)
process, differenced at lag 12 or as a
SARIMA(3, 0, 0) × (0, 1, 0)<sub>12</sub>. The final model
was
(1 − <em>B</em><sup>12</sup>)(1 − 0.257<em>B</em> − 0.401<em>B</em><sup>2</sup> − 0.313<em>B</em><sup>3</sup>)<em>X</em><sub><em>t</em></sub> = <em>Z</em><sub><em>t</em></sub></p>
<p>where <em>Z</em><sub><em>t</em></sub> ∼ <em>N</em>(0, 0.00032)</p>
<p>From our results we found that we could forecast retail sales in food
services and drinking places that were close to the true values. We
found that retail sales are generally the lowest in January, with the
summer months of May to August being the busiest for this industry.
There are spikes in activity in March, October, and December, coinciding
with Spring break, Halloween, and Christmas. Our forecasts show a slow,
steady growth in this industry over the next two years representing a
safe investment opportunity. However, Covid-19 may cause permanent
shifts in this industry, and the long-term effects of the pandemic are
not captured in this study.</p>
</section>
<section id="v-references">
<h1>V. References<a class="headerlink" href="#v-references" title="Permalink to this headline">¶</a></h1>
<p>U.S. Census Bureau, Retail Sales [RSFSDPN], retrieved from FRED,
Federal Reserve Bank of St. Louis;
<a href="https://fred.stlouisfed.org/series/RSFSDPN" class="uri">https://fred.stlouisfed.org/series/RSFSDPN</a>,
June 11, 2020.</p>
</section>
<section id="vi-appendix">
<h1>VI. Appendix<a class="headerlink" href="#vi-appendix" title="Permalink to this headline">¶</a></h1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Convert data into time series object
Sales &lt;- ts(Sales.csv[,2], start = c(2010,1),frequency=12)

# Split into Training/Test sets, leave 12 observations for forecasting
Sales.train &lt;- ts(Sales[c(1:109)],start = c(2010,1),frequency=12)
Sales.test &lt;- ts(Sales[c(110:length(Sales))],start = c(2019,2),frequency=12)

# Plot Training data with mean and trend
autoplot(Sales.train) +
  geom_smooth(method = &quot;lm&quot;, se = FALSE, color = &#39;red&#39;) +             
  labs(x = &quot;Year&quot;, y = &quot;Millions of Dollars&quot;) +
  ggtitle(&quot;Sales.Train&quot;) +
  geom_hline(yintercept = mean(Sales), color=&quot;blue&quot;)

# Plot histogram of training data
gghistogram(Sales.train, add.normal=TRUE) # Data looks normally distributed

# Plot ACF
ggAcf(Sales.train, lag = 48) +
  ggtitle(&#39;ACF of Retail Sales&#39;)

# Plot PACF
ggPacf(Sales.train, lag = 48) +
  ggtitle(&#39;PACF of Retail Sales&#39;)

## Boxcox transformation
bcTransform &lt;- boxcox(Sales.train~as.numeric(1:length(Sales.train))) 
lambda = bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
# lambda

# Since 0 is in confidence interval log transform data
Sales.train.log &lt;- log(Sales.train)
Sales.log &lt;- log(Sales)

# Plot log transformed Training data
autoplot(Sales.train.log) +
  labs(x = &quot;Year&quot;, y = &quot;Log Millions of Dollars&quot;) +
  ggtitle(&quot;Log Sales.train&quot;)

gghistogram(Sales.train.log, add.normal = TRUE) # Data looks normally distributed

# Plot ACF
ggAcf(Sales.train.log, lag = 48) +
  ggtitle(&#39;ACF of Log Retail Sales&#39;)

# Plot PACF
ggPacf(Sales.train.log, lag = 48) +
  ggtitle(&#39;PACF of Log Retail Sales&#39;)


## Differencing Sales.train.log at lag 12 to remove seasonality
print(&#39;Variance of Sales.train.log&#39;)
var(Sales.train.log)
Sales.train.log_12 &lt;- diff(Sales.train.log, lag=12)
print(&#39;Variance of Sales.train.log differenced at lag 12&#39;)
var(Sales.train.log_12) # Variance is lower 
# var(Sales.train.log) &gt; var(Sales.train.log_12)

# Plot
autoplot(Sales.train.log_12)+
  geom_smooth(method = &quot;lm&quot;, se = FALSE, color = &#39;red&#39;) +
  geom_hline(yintercept = mean(Sales.train.log_12), color=&quot;blue&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Log Millions of Dollars&quot;) +
  ggtitle(&quot;Sales.train.log differenced at lag 12&quot;) 
# Data looks stationary after eliminating seasonality

gghistogram(Sales.train.log_12, add.normal=TRUE) # Data looks normally distributed

# Plot ACF 
ggAcf(Sales.train.log_12, lag = 100) +
  ggtitle(&#39;ACF of Log Retail Sales differenced at lag 12&#39;)

# Plot PACF
ggPacf(Sales.train.log_12, lag = 100) +
  ggtitle(&#39;PACF of Log Retail Sales differenced at lag 12&#39;)
  
# Differencing Sales.train.log again at lag 12 and lag 1 to remove trend

Sales.train.log_1_12 &lt;- diff(Sales.train.log_12, lag=1)
print(&quot;Variance of Sales.train.log differenced at lag 1 and lag 12&quot;)
var(Sales.train.log_1_12) 

# var(Sales.train.log_12) &gt; var(Sales.train.log_1_12) # Variance is higher, overdifferenced: Do not difference at lag 1

## Model Estimation
print(&quot;Model A&quot;)
# Estimate parameters of SARIMA model
a = arima(Sales.train.log, order=c(3,0,0), seasonal = list(order = c(0,1,0), period = 12),method=&quot;ML&quot;)
a

print(&quot;Model B&quot;)
# Estimate parameters of SARIMA model
b = arima(Sales.train.log, order=c(2,0,0), seasonal = list(order = c(1,1,0), period = 0), method=&quot;ML&quot;)
b

print(&quot;Model C&quot;)
# Estimate parameters of SARIMA model
c = arima(Sales.train.log, order=c(3,0,0), seasonal = list(order = c(1,1,0), period = 12), method=&quot;ML&quot;)
c

print(&quot;Model D&quot;)
# Estimate parameters of SARIMA model
d = arima(Sales.train.log, order=c(2,0,0), seasonal = list(order = c(0,1,0), period = 12), method=&quot;ML&quot;)
d

# Plot inverse roots of AR part: They should all be inside unit circle
plot(a, main = &#39;Inverse AR roots of model A&#39;)

# Plot inverse roots of AR part: They should all be inside unit circle
plot(b, main = &#39;Inverse AR roots of model A&#39;)


## Diagnostic Checking, model A
# Get residuals of model a
res.a &lt;- residuals(a)

# Plot residuals
autoplot(res.a) +
  geom_smooth(method = &quot;lm&quot;, se = FALSE, color = &#39;red&#39;) +   
  labs(x = &quot;Time&quot;) +
  ggtitle(&quot;res.a plot&quot;) +
  geom_hline(yintercept = mean(res.a), color=&quot;blue&quot;)
# mean(res.a) # Sample mean is about 0

# Plot histogram of residuals
gghistogram(res.a,add.normal = TRUE)

# Plot ACF/PACF
ggAcf(res.a,lag.max = 48);ggPacf(res.a,lag.max=48)

# Normal Q-Q Plot
qqnorm(res.a) 
qqline(res.a,col=&#39;blue&#39;)

# square residuals for Mcleod-Li test
res.a.sq &lt;- res.a^2
ggAcf(res.a.sq, lag.max = 48)

# Test residuals for normality
shapiro.test(res.a)

# Square-root of 121 = 11. p = 3, q = 0 so fitdf = p +q = 3
Box.test(res.a, lag=11, type = c(&#39;Box-Pierce&#39;),fitdf =3) 
Box.test(res.a, lag=11, type = c(&#39;Ljung-Box&#39;),fitdf =3)

# Mcleod-li test
Box.test(res.a.sq, lag=11, type = c(&#39;Ljung-Box&#39;),fitdf =0)

# Check if residuals fit to WN Process
ar(res.a, aic = TRUE, order.max = NULL, method = c(&quot;yule-walker&quot;))

print(&#39;AICC of Model A&#39;)
AICc(a)

## Diagnostic Checking, model D
# Get residuals of model c
res.d &lt;- residuals(d)

# Plot residuals
autoplot(res.d) +
  geom_smooth(method = &quot;lm&quot;, se = FALSE, color = &#39;red&#39;) +   
  labs(x = &quot;Time&quot;) +
  ggtitle(&quot;res.d plot&quot;) +
  geom_hline(yintercept = mean(res.d), color=&quot;blue&quot;)
# mean(res.d) # Sample mean is about 0

# Plot histogram of residuals
gghistogram(res.d, add.normal = TRUE) 

# Plot ACF/PACF
ggAcf(res.d,lag.max = 48);ggPacf(res.d,lag.max=48)

# Normal Q-Q Plot
qqnorm(res.d) 
qqline(res.d,col=&#39;blue&#39;)

# square residuals for Mcleod-Li test
res.d.sq &lt;- res.d^2
ggAcf(res.d.sq, lag.max = 48)

# Test residuals for normality
shapiro.test(res.d)

# Square-root of 121 = 11. p = 2, q = 0 so fitdf = p +q = 3
Box.test(res.d, lag=11, type = c(&#39;Box-Pierce&#39;),fitdf =2)
Box.test(res.d, lag=11, type = c(&#39;Ljung-Box&#39;),fitdf =2)

# Mcleod-li test
Box.test(res.d.sq, lag=11, type = c(&#39;Ljung-Box&#39;),fitdf =0)

# Check if residuals fit to WN Process
ar(res.d, aic = TRUE, order.max = NULL, method = c(&quot;yule-walker&quot;))

print(&#39;AICC of Model D&#39;)
AICc(d)

## Forecast on log-transformed data using Model A
autoplot(Sales.log, series = &#39;data&#39;,color=&#39;black&#39;) +
  autolayer(forecast(a,level=c(95)), series = &#39;Forecast&#39;,linetype=&#39;dashed&#39;) +
  autolayer(log(Sales.test), series=&#39;True values&#39;,color=&#39;black&#39;)+
  ggtitle(&#39;Forecast of Log Retail Sales&#39;)

# Zoom in
autoplot(window(Sales.log,start=2018), series = &#39;data&#39;,color=&#39;black&#39;) +
  autolayer(forecast(a,level=c(95)), series = &#39;Forecast&#39;, linetype=&#39;dashed&#39;) +
  autolayer(log(Sales.test), series=&#39;True values&#39;,color=&#39;black&#39;) +
  ggtitle(&#39;Forecast of Log Retail Sales&#39;) +
  geom_point()

# Fit model to and forecast original data
pred.orig &lt;- forecast(arima(Sales.train, order=c(3,0,0), seasonal = list(order = c(1,1,0), period = 12),method=&quot;ML&quot;),level=c(95))

## Forecast on original data using Model A
autoplot(Sales, series = &#39;data&#39;,color=&#39;black&#39;) +
  autolayer(pred.orig, series = &#39;Forecast&#39;, linetype=&#39;dashed&#39;) +
  autolayer(Sales.test, series=&#39;True values&#39;,color=&#39;black&#39;)+
  ggtitle(&#39;Forecast of Retail Sales&#39;)

# Zoom in
autoplot(window(Sales,start=2018), series = &#39;data&#39;,color=&#39;black&#39;) +
  autolayer(pred.orig,series = &#39;Forecast&#39;,  linetype=&#39;dashed&#39;) +
  ggtitle(&#39;Forecast of Retail Sales &#39;) +
  autolayer(Sales.test, series=&#39;True values&#39;,color=&#39;black&#39;) + 
  geom_point() +
  ggtitle(&#39;Forecast of Retail Sales&#39;)
</pre></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./undergrad"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../viz.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">From school</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="lolwin.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">League of Legends Win Classifier</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Lawrence Lin<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>